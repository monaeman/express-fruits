"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var preset_env_1 = __importDefault(require("@babel/preset-env"));
var preset_react_1 = __importDefault(require("@babel/preset-react"));
var path_1 = require("path");
var react_1 = __importDefault(require("react"));
var server_1 = __importDefault(require("react-dom/server"));
var require_1 = require("./require");
require('@babel/register')({ presets: [preset_react_1.default, preset_env_1.default] });
module.exports = function render(options) {
    return function (filename, props, callback) {
        var _a = options || {}, _b = _a.cache, cache = _b === void 0 ? true : _b, layout = _a.layout;
        if (!cache) {
            require_1._clearCache(this.root, this.ext);
        }
        try {
            var component = react_1.default.createElement(require_1._require(filename), props);
            if (layout) {
                var layoutPath = path_1.join(this.root, "" + layout + this.ext);
                component = react_1.default.createElement(require_1._require(layoutPath), props, component);
            }
            callback(null, server_1.default.renderToStaticMarkup(component));
        }
        catch (error) {
            callback(error);
        }
    };
};
